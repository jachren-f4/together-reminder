<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=390, height=844, initial-scale=1.0">
    <title>Us 2.0 - Together Mode Quiz Flow</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ===========================================
           Design tokens from us2_theme.dart
           =========================================== */
        :root {
            /* Background gradient */
            --bg-start: #FFD1C1;
            --bg-end: #FFF5F0;
            /* Primary */
            --pink: #FF5E62;
            /* Accent gradient */
            --grad-start: #FF6B6B;
            --grad-end: #FF9F43;
            /* Card salmon gradient */
            --salmon-start: #FF7B6B;
            --salmon-end: #FF6B5B;
            /* Surfaces */
            --cream: #FFF8F0;
            --beige: #F5E6D8;
            /* Text */
            --text-dark: #3A3A3A;
            --text-med: #5A5A5A;
            --text-light: #707070;
            /* Glow */
            --glow-pink: rgba(255,107,107,0.4);
            /* Dark (handoff screen) */
            --dark-bg: #1A1A2E;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nunito', sans-serif;
            min-height: 100vh;
            background: #F0E8E4;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .phone {
            width: 390px;
            height: 844px;
            border-radius: 40px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0,0,0,0.15);
            position: relative;
        }

        /* Step navigation */
        .step-nav {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 200;
            background: rgba(0,0,0,0.6);
            padding: 6px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        .step-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-family: 'Nunito', sans-serif;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            color: white;
            background: transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .step-btn.active { background: var(--pink); }
        .step-btn:hover:not(.active) { background: rgba(255,255,255,0.1); }

        /* Screen transitions */
        .screen {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: none;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            overflow-y: auto;
        }
        .screen.active {
            display: flex;
            opacity: 1;
            pointer-events: all;
            z-index: 10;
        }
        .screen::-webkit-scrollbar { display: none; }
        .screen { -ms-overflow-style: none; scrollbar-width: none; }

        /* ===========================================
           STEP 1: QUIZ INTRO
           Matches: Us2IntroScreen.withQuizCard()
           Source: us2_intro_screen.dart
           =========================================== */
        .intro-screen {
            background: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%);
        }

        /* Back button - 40x40 white circle, shadow */
        .intro-back {
            padding: 16px;
        }
        .back-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .back-btn svg { width: 20px; height: 20px; }

        /* Scrollable content area */
        .intro-content {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px;
        }

        /* Hero image - full width, 180px, 16px radius */
        .intro-hero {
            width: 100%;
            height: 180px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(255,94,98,0.3), rgba(255,159,67,0.2));
            box-shadow: 0 4px 20px rgba(255,94,98,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        .hero-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            opacity: 0.5;
        }
        .hero-placeholder svg { width: 48px; height: 48px; }
        .hero-placeholder span {
            font-size: 11px;
            font-weight: 600;
            color: white;
            letter-spacing: 1px;
        }

        /* Badges - 2px border-radius (from _Us2Badge) */
        .intro-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        .badge {
            padding: 6px 12px;
            border-radius: 2px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: white;
            text-transform: uppercase;
        }
        .badge-primary { background: var(--text-dark); }
        .badge-secondary { background: linear-gradient(135deg, var(--grad-start), var(--grad-end)); }

        /* Quiz info card - white, 12px radius, 4px pink left border */
        .quiz-info-card {
            background: white;
            border-radius: 12px;
            border-left: 4px solid var(--pink);
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 16px;
            margin-bottom: 16px;
        }
        .quiz-theme-label {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: var(--pink);
            margin-bottom: 4px;
        }
        .quiz-card-title {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }
        .quiz-card-desc {
            font-size: 14px;
            font-style: italic;
            color: var(--text-med);
            line-height: 1.5;
        }

        /* Instruction text */
        .instruction-text {
            font-size: 14px;
            color: var(--text-med);
            line-height: 1.5;
            margin-bottom: 20px;
        }

        /* Stats card - white, 12px radius */
        .stats-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 16px;
            margin-bottom: 16px;
        }
        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        .stats-label {
            font-size: 13px;
            color: var(--text-med);
        }
        .stats-value {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-dark);
        }
        .stats-value.highlight { color: var(--pink); }
        .stats-divider {
            height: 1px;
            background: #F0F0F0;
        }

        /* Single-phone info note */
        .single-phone-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #FFF0EE, #FFE4D6);
            border: 1px solid rgba(255,94,98,0.2);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 20px;
        }
        .single-phone-info svg { flex-shrink: 0; }
        .single-phone-info span {
            font-size: 14px;
            font-weight: 600;
            color: #D84315;
        }

        /* Bottom button area - fixed at bottom */
        .intro-bottom {
            padding: 24px;
        }
        .btn-start {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, var(--grad-start), var(--grad-end));
            color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 25px var(--glow-pink);
            transition: transform 0.15s;
        }
        .btn-start:active { transform: scale(0.97); }

        /* ===========================================
           STEP 2 & 4: QUESTION SCREENS
           Matches: _buildUs2Screen() in quiz_match_game_screen.dart
           =========================================== */
        .question-screen {
            background: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%);
        }

        /* Header bar - white 50%, close btn + title + counter + progress */
        .q-header {
            background: rgba(255,255,255,0.5);
            padding: 12px 16px;
        }
        .q-header-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .q-close-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: rgba(255,255,255,0.6);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .q-close-btn svg { width: 20px; height: 20px; }
        .q-title {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            flex: 1;
        }
        /* Counter badge - accent gradient pill */
        .q-counter {
            padding: 6px 14px;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--grad-start), var(--grad-end));
            font-size: 13px;
            font-weight: 700;
            color: white;
            white-space: nowrap;
        }
        /* Player chip (single-phone addition) */
        .player-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }
        .chip-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .chip-dot-pink { background: var(--pink); }
        .chip-dot-blue { background: #45B7D1; }
        .chip-text {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-dark);
        }
        /* Progress bar - 6px height, white 80% bg, gradient fill */
        .q-progress-bar {
            margin-top: 12px;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.8);
            overflow: hidden;
        }
        .q-progress-fill {
            height: 100%;
            border-radius: 3px;
            background: linear-gradient(90deg, var(--grad-start), var(--grad-end));
            transition: width 0.3s ease-out;
        }

        /* Question content area */
        .q-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .q-content::-webkit-scrollbar { display: none; }

        /* Question text - Playfair 24px */
        .question-text {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 600;
            color: var(--text-dark);
            line-height: 1.4;
            margin-bottom: 24px;
        }

        /* Option cards - cream bg, beige border, 16px radius */
        .option-card {
            background: var(--cream);
            border: 1px solid var(--beige);
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 10px;
        }
        .option-card:hover {
            border-color: rgba(255,94,98,0.3);
        }
        /* Selected state - salmon gradient, glow shadow */
        .option-card.selected {
            background: linear-gradient(135deg, var(--salmon-start), var(--salmon-end));
            border-color: transparent;
            box-shadow: 0 6px 20px rgba(255,107,107,0.35);
        }
        /* Letter circle - 36x36 */
        .option-letter {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-dark);
            background: rgba(255,255,255,0.5);
            border: 2px solid var(--text-med);
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .option-card.selected .option-letter {
            background: rgba(255,255,255,0.3);
            border-color: white;
            color: white;
        }
        /* Option text */
        .option-text {
            font-size: 15px;
            font-weight: 400;
            color: var(--text-dark);
            line-height: 1.4;
            flex: 1;
            transition: all 0.2s;
        }
        .option-card.selected .option-text {
            color: white;
            font-weight: 600;
        }
        /* Checkmark (hidden until selected) */
        .option-check {
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.2s;
        }
        .option-card.selected .option-check {
            opacity: 1;
            transform: scale(1);
        }
        .option-check svg { width: 22px; height: 22px; }

        /* Footer - white 50% bg */
        .q-footer {
            padding: 20px;
            background: rgba(255,255,255,0.5);
        }
        .btn-next {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 30px;
            font-family: 'Nunito', sans-serif;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
        }
        .btn-next.enabled {
            background: linear-gradient(135deg, var(--grad-start), var(--grad-end));
            color: white;
            box-shadow: 0 8px 25px var(--glow-pink);
        }
        .btn-next.disabled {
            background: var(--beige);
            color: var(--text-light);
            cursor: default;
        }
        .btn-next.enabled:active { transform: scale(0.97); }

        /* ===========================================
           STEP 3: HANDOFF SCREEN (single-phone specific)
           Dark theme for privacy during phone pass
           =========================================== */
        .handoff-screen {
            background: var(--dark-bg);
            align-items: center;
            justify-content: center;
            padding: 40px 24px;
            text-align: center;
            overflow: hidden;
        }
        .handoff-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,94,98,0.3) 0%, transparent 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -60%);
            animation: glowPulse 3s ease-in-out infinite;
        }
        @keyframes glowPulse {
            0%, 100% { transform: translate(-50%, -60%) scale(1); opacity: 0.8; }
            50% { transform: translate(-50%, -60%) scale(1.15); opacity: 1; }
        }
        /* Lock icon - SVG not emoji */
        .handoff-lock {
            position: absolute;
            top: 60px;
            left: 28px;
            opacity: 0.5;
        }
        .handoff-lock svg { width: 24px; height: 24px; }
        /* Partner avatar - gradient circle with initial */
        .handoff-avatar {
            position: relative;
            z-index: 1;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6C9CE9, #45B7D1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 44px;
            font-weight: 800;
            color: white;
            margin-bottom: 28px;
        }
        .handoff-title {
            font-family: 'Pacifico', cursive;
            font-size: 32px;
            color: white;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }
        .handoff-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }
        .handoff-instruction {
            font-size: 14px;
            color: rgba(255,255,255,0.4);
            margin-bottom: 48px;
            position: relative;
            z-index: 1;
        }
        .btn-ready {
            padding: 18px 48px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, var(--grad-start), var(--grad-end));
            color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(255,107,107,0.3);
            position: relative;
            z-index: 1;
            animation: readyPulse 2s ease-in-out infinite;
        }
        @keyframes readyPulse {
            0%, 100% { box-shadow: 0 8px 24px rgba(255,107,107,0.3); }
            50% { box-shadow: 0 8px 40px rgba(255,107,107,0.5), 0 0 60px rgba(255,107,107,0.15); }
        }
        .btn-ready:active { transform: scale(0.97); }

        /* ===========================================
           STEP 5: RESULTS
           Matches: _buildUs2Screen() in quiz_match_results_screen.dart
           Shows ALIGNED / DIFFERENT counts (not fraction)
           =========================================== */
        .results-screen {
            background: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%);
        }

        /* Results header - same as question header */
        .r-header {
            background: rgba(255,255,255,0.5);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Score summary section - white 30% bg */
        .score-section {
            background: rgba(255,255,255,0.3);
            padding: 32px 24px;
            text-align: center;
        }
        .score-row {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 0;
            margin-bottom: 20px;
        }
        .score-col {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .score-number {
            font-family: 'Playfair Display', serif;
            font-size: 56px;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1;
        }
        .score-label {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: var(--text-med);
            margin-top: 8px;
        }
        .score-separator {
            font-size: 40px;
            color: var(--beige);
            line-height: 1;
            padding: 0 24px;
            padding-bottom: 28px;
        }
        .score-description {
            font-size: 16px;
            font-style: italic;
            color: var(--text-med);
            line-height: 1.5;
            margin-bottom: 24px;
        }

        /* Stat pills */
        .stat-pills {
            display: flex;
            justify-content: center;
            gap: 12px;
        }
        .stat-pill {
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        .stat-pill-normal {
            background: var(--cream);
            border: 1px solid rgba(0,0,0,0.05);
            color: var(--text-dark);
        }
        .stat-pill-highlight {
            background: linear-gradient(135deg, var(--salmon-start), var(--salmon-end));
            color: white;
            box-shadow: 0 3px 10px rgba(255,107,107,0.3);
        }

        /* Divider */
        .results-divider {
            height: 1px;
            background: var(--beige);
        }

        /* Section header */
        .section-header {
            padding: 24px 24px 16px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: var(--text-med);
        }

        /* Question comparison cards */
        .q-card {
            margin: 0 20px 8px;
            border-radius: 16px;
            border: 1px solid rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .q-card-match { background: rgba(232,245,233,0.7); }
        .q-card-diff { background: var(--cream); }

        .q-card-header {
            padding: 16px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        /* Number circle - 28x28 */
        .q-num {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }
        .q-num-match { background: linear-gradient(135deg, #4CAF50, #388E3C); }
        .q-num-diff { background: linear-gradient(135deg, var(--salmon-start), var(--salmon-end)); }

        .q-card-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
            line-height: 1.4;
            flex: 1;
        }

        /* Alignment badge */
        .align-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        .align-badge-match {
            background: #4CAF50;
            color: white;
        }
        .align-badge-diff {
            background: transparent;
            border: 1px solid var(--text-med);
            color: var(--text-med);
        }

        /* Answer rows */
        .q-card-answers { padding: 16px; }
        .answer-row {
            display: flex;
            align-items: flex-start;
            gap: 0;
            margin-bottom: 10px;
        }
        .answer-row:last-child { margin-bottom: 0; }
        .answer-name {
            width: 70px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: var(--text-light);
            text-transform: uppercase;
            padding-top: 2px;
            flex-shrink: 0;
        }
        .answer-text {
            font-size: 14px;
            color: var(--text-dark);
            line-height: 1.4;
        }
        .answer-text.bold { font-weight: 600; }

        /* Return Home button (inside scroll) */
        .btn-return-home {
            margin: 24px 20px 40px;
            padding: 18px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, var(--grad-start), var(--grad-end));
            color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 25px var(--glow-pink);
            width: calc(100% - 40px);
            display: block;
        }
        .btn-return-home:active { transform: scale(0.97); }
    </style>
</head>
<body>

<!-- Step Navigation -->
<div class="step-nav">
    <button class="step-btn active" onclick="goToStep(1)">1. Intro</button>
    <button class="step-btn" onclick="goToStep(2)">2. P1 Quiz</button>
    <button class="step-btn" onclick="goToStep(3)">3. Handoff</button>
    <button class="step-btn" onclick="goToStep(4)">4. P2 Quiz</button>
    <button class="step-btn" onclick="goToStep(5)">5. Results</button>
</div>

<div class="phone">

    <!-- ==========================================
         STEP 1: Quiz Intro
         Layout from Us2IntroScreen.withQuizCard()
         ========================================== -->
    <div class="screen intro-screen active" id="step1">
        <!-- Back button -->
        <div class="intro-back">
            <button class="back-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="#3A3A3A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
        </div>

        <!-- Scrollable content -->
        <div class="intro-content">
            <!-- Hero image area (180px, 16px radius) -->
            <div class="intro-hero">
                <div class="hero-placeholder">
                    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <path d="M21 15l-5-5L5 21"/>
                    </svg>
                    <span>QUIZ HERO IMAGE</span>
                </div>
            </div>

            <!-- Badges (2px border-radius) -->
            <div class="intro-badges">
                <div class="badge badge-primary">CLASSIC QUIZ</div>
                <div class="badge badge-secondary">DAILY</div>
            </div>

            <!-- Quiz info card (white, 12px radius, 4px pink left border) -->
            <div class="quiz-info-card">
                <div class="quiz-theme-label">TODAY'S THEME</div>
                <div class="quiz-card-title">Communication Styles</div>
                <div class="quiz-card-desc">Explore how you and your partner express yourselves and navigate conversations.</div>
            </div>

            <!-- Instruction text -->
            <div class="instruction-text">Both you and Taija answer the same questions about yourselves. Then see where you align and where you differ!</div>

            <!-- Stats card -->
            <div class="stats-card">
                <div class="stats-row">
                    <span class="stats-label">Questions</span>
                    <span class="stats-value">5</span>
                </div>
                <div class="stats-divider"></div>
                <div class="stats-row">
                    <span class="stats-label">Reward</span>
                    <span class="stats-value highlight">+30 LP</span>
                </div>
            </div>

            <!-- Single-phone info note -->
            <div class="single-phone-info">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#FF5E62" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="5" y="2" width="14" height="20" rx="3"/>
                    <line x1="12" y1="18" x2="12.01" y2="18"/>
                </svg>
                <span>You both play on this phone. Joakim goes first.</span>
            </div>
        </div>

        <!-- Bottom button (30px radius) -->
        <div class="intro-bottom">
            <button class="btn-start" onclick="goToStep(2)">Begin Quiz</button>
        </div>
    </div>

    <!-- ==========================================
         STEP 2: Player 1 (Joakim) Answering
         Layout from _buildUs2Screen() in quiz_match_game_screen.dart
         ========================================== -->
    <div class="screen question-screen" id="step2">
        <!-- Header with close, title, player chip, counter, progress bar -->
        <div class="q-header">
            <div class="q-header-row">
                <button class="q-close-btn" onclick="goToStep(1)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#3A3A3A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
                <div class="q-title">Communication Styles</div>
                <div class="player-chip">
                    <div class="chip-dot chip-dot-pink"></div>
                    <span class="chip-text">Joakim</span>
                </div>
                <div class="q-counter" id="p1-counter">1 of 5</div>
            </div>
            <div class="q-progress-bar">
                <div class="q-progress-fill" id="p1-progress" style="width: 0%"></div>
            </div>
        </div>

        <!-- Question content -->
        <div class="q-content" id="p1-content">
            <div class="question-text" id="p1-qtext">How do you prefer to resolve disagreements?</div>
            <div id="p1-options">
                <!-- Options rendered by JS -->
            </div>
        </div>

        <!-- Footer -->
        <div class="q-footer">
            <button class="btn-next disabled" id="p1-btn" onclick="nextP1()">Next Question</button>
        </div>
    </div>

    <!-- ==========================================
         STEP 3: Handoff Screen (single-phone specific)
         Dark theme for privacy during phone pass
         ========================================== -->
    <div class="screen handoff-screen" id="step3">
        <div class="handoff-glow"></div>
        <!-- Lock icon (SVG, not emoji) -->
        <div class="handoff-lock">
            <svg viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0110 0v4"/>
            </svg>
        </div>
        <!-- Partner avatar (gradient circle with initial) -->
        <div class="handoff-avatar">T</div>
        <div class="handoff-title">Taija's turn!</div>
        <div class="handoff-subtitle">No peeking, Joakim!</div>
        <div class="handoff-instruction">Hand over the phone...</div>
        <button class="btn-ready" onclick="goToStep(4)">I'M READY</button>
    </div>

    <!-- ==========================================
         STEP 4: Player 2 (Taija) Answering
         Same layout as Step 2 but with Taija's player chip
         ========================================== -->
    <div class="screen question-screen" id="step4">
        <div class="q-header">
            <div class="q-header-row">
                <button class="q-close-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#3A3A3A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
                <div class="q-title">Communication Styles</div>
                <div class="player-chip">
                    <div class="chip-dot chip-dot-blue"></div>
                    <span class="chip-text">Taija</span>
                </div>
                <div class="q-counter" id="p2-counter">1 of 5</div>
            </div>
            <div class="q-progress-bar">
                <div class="q-progress-fill" id="p2-progress" style="width: 0%"></div>
            </div>
        </div>

        <div class="q-content" id="p2-content">
            <div class="question-text" id="p2-qtext">How do you prefer to resolve disagreements?</div>
            <div id="p2-options"></div>
        </div>

        <div class="q-footer">
            <button class="btn-next disabled" id="p2-btn" onclick="nextP2()">Next Question</button>
        </div>
    </div>

    <!-- ==========================================
         STEP 5: Results
         Layout from _buildUs2Screen() in quiz_match_results_screen.dart
         Shows ALIGNED / DIFFERENT counts (not fraction)
         ========================================== -->
    <div class="screen results-screen" id="step5">
        <!-- Header -->
        <div class="r-header">
            <button class="q-close-btn" onclick="goToStep(1)">
                <svg viewBox="0 0 24 24" fill="none" stroke="#3A3A3A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
            <div class="q-title">Communication Styles</div>
        </div>

        <!-- Score summary -->
        <div class="score-section">
            <div class="score-row">
                <div class="score-col">
                    <div class="score-number" id="aligned-count">3</div>
                    <div class="score-label">ALIGNED</div>
                </div>
                <div class="score-separator">&middot;</div>
                <div class="score-col">
                    <div class="score-number" id="different-count">2</div>
                    <div class="score-label">DIFFERENT</div>
                </div>
            </div>
            <div class="score-description" id="score-desc">Mostly aligned, with some interesting differences to discuss.</div>
            <div class="stat-pills">
                <div class="stat-pill stat-pill-normal">5 questions</div>
                <div class="stat-pill stat-pill-highlight">+30 LP</div>
            </div>
        </div>

        <!-- Divider -->
        <div class="results-divider"></div>

        <!-- Section header -->
        <div class="section-header">ANSWER COMPARISON</div>

        <!-- Question comparison cards (rendered by JS) -->
        <div id="breakdown-list"></div>

        <!-- Return Home button -->
        <button class="btn-return-home" onclick="goToStep(1)">Return Home</button>
    </div>

</div>

<script>
    // Quiz data
    const questions = [
        {
            text: "How do you prefer to resolve disagreements?",
            options: [
                "Talk it out immediately",
                "Take time to cool down first",
                "Write down my thoughts",
                "Seek a compromise quickly"
            ]
        },
        {
            text: "When your partner is upset, what's your first instinct?",
            options: [
                "Give them space",
                "Ask what's wrong right away",
                "Offer a hug or physical comfort",
                "Try to fix the problem"
            ]
        },
        {
            text: "How do you prefer to show love?",
            options: [
                "Words of affirmation",
                "Quality time together",
                "Small gifts or surprises",
                "Acts of service"
            ]
        },
        {
            text: "What topic do you find hardest to discuss?",
            options: [
                "Finances and money",
                "Future plans and goals",
                "Feelings and emotions",
                "Family and boundaries"
            ]
        },
        {
            text: "After a disagreement, what helps you reconnect?",
            options: [
                "A sincere apology",
                "Doing something fun together",
                "Talking through what happened",
                "Giving it time and moving on"
            ]
        }
    ];

    // Simulated answers (P1=Joakim, P2=Taija)
    const p1Answers = [0, 1, 1, 2, 0];
    const p2Answers = [0, 3, 1, 0, 0];
    const matchResults = p1Answers.map((a, i) => a === p2Answers[i]);

    let currentStep = 1;
    let p1CurrentQ = 0;
    let p2CurrentQ = 0;
    let p1Selected = new Array(5).fill(-1);
    let p2Selected = new Array(5).fill(-1);

    function goToStep(step) {
        const prev = document.getElementById('step' + currentStep);
        const next = document.getElementById('step' + step);

        prev.classList.remove('active');
        next.classList.add('active');
        currentStep = step;

        document.querySelectorAll('.step-btn').forEach((btn, i) => {
            btn.classList.toggle('active', i + 1 === step);
        });

        if (step === 2) { p1CurrentQ = 0; p1Selected = new Array(5).fill(-1); renderP1(); }
        if (step === 4) { p2CurrentQ = 0; p2Selected = new Array(5).fill(-1); renderP2(); }
        if (step === 5) { renderResults(); }
    }

    // Render option HTML matching Us2 style
    function renderOptions(q, selectedIndex, prefix) {
        const letters = ['A', 'B', 'C', 'D', 'E'];
        return q.options.map((opt, i) => {
            const sel = selectedIndex === i ? 'selected' : '';
            return `
                <div class="option-card ${sel}" onclick="select${prefix}(${i})">
                    <div class="option-letter">${letters[i]}</div>
                    <div class="option-text">${opt}</div>
                    <div class="option-check">
                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                    </div>
                </div>
            `;
        }).join('');
    }

    // P1 rendering
    function renderP1() {
        const q = questions[p1CurrentQ];
        document.getElementById('p1-counter').textContent = `${p1CurrentQ + 1} of 5`;
        document.getElementById('p1-qtext').textContent = q.text;
        document.getElementById('p1-options').innerHTML = renderOptions(q, p1Selected[p1CurrentQ], 'P1');
        document.getElementById('p1-progress').style.width = `${(p1CurrentQ / 5) * 100}%`;

        const btn = document.getElementById('p1-btn');
        const allAnswered = p1Selected.every(s => s >= 0);
        const hasAnswer = p1Selected[p1CurrentQ] >= 0;
        btn.textContent = p1CurrentQ < 4 ? 'Next Question' : 'Submit Answers';
        btn.className = `btn-next ${hasAnswer ? 'enabled' : 'disabled'}`;
    }

    function selectP1(i) {
        p1Selected[p1CurrentQ] = i;
        renderP1();
    }

    function nextP1() {
        if (p1Selected[p1CurrentQ] < 0) return;
        if (p1CurrentQ < 4) {
            p1CurrentQ++;
            renderP1();
        } else {
            // Submit - go to handoff
            document.getElementById('p1-progress').style.width = '100%';
            setTimeout(() => goToStep(3), 300);
        }
    }

    // P2 rendering
    function renderP2() {
        const q = questions[p2CurrentQ];
        document.getElementById('p2-counter').textContent = `${p2CurrentQ + 1} of 5`;
        document.getElementById('p2-qtext').textContent = q.text;
        document.getElementById('p2-options').innerHTML = renderOptions(q, p2Selected[p2CurrentQ], 'P2');
        document.getElementById('p2-progress').style.width = `${(p2CurrentQ / 5) * 100}%`;

        const btn = document.getElementById('p2-btn');
        btn.textContent = p2CurrentQ < 4 ? 'Next Question' : 'Submit Answers';
        btn.className = `btn-next ${p2Selected[p2CurrentQ] >= 0 ? 'enabled' : 'disabled'}`;
    }

    function selectP2(i) {
        p2Selected[p2CurrentQ] = i;
        renderP2();
    }

    function nextP2() {
        if (p2Selected[p2CurrentQ] < 0) return;
        if (p2CurrentQ < 4) {
            p2CurrentQ++;
            renderP2();
        } else {
            document.getElementById('p2-progress').style.width = '100%';
            setTimeout(() => goToStep(5), 300);
        }
    }

    // Results rendering
    function renderResults() {
        const aligned = matchResults.filter(m => m).length;
        const different = matchResults.filter(m => !m).length;

        document.getElementById('aligned-count').textContent = aligned;
        document.getElementById('different-count').textContent = different;

        // Description text (matching _getResultDescription)
        let desc;
        if (different === 0) desc = "You're naturally aligned on everything!";
        else if (aligned === 0) desc = "Lots of differences to explore\u2014now you understand each other better!";
        else if (aligned > different) desc = "Mostly aligned, with some interesting differences to discuss.";
        else if (different > aligned) desc = "Different perspectives on most\u2014great insights about each other!";
        else desc = "A balance of shared views and unique perspectives.";
        document.getElementById('score-desc').textContent = desc;

        // Question comparison cards
        const list = document.getElementById('breakdown-list');
        list.innerHTML = questions.map((q, i) => {
            const matched = matchResults[i];
            const p1Opt = q.options[p1Answers[i]];
            const p2Opt = q.options[p2Answers[i]];
            const cardClass = matched ? 'q-card-match' : 'q-card-diff';
            const numClass = matched ? 'q-num-match' : 'q-num-diff';
            const badgeClass = matched ? 'align-badge-match' : 'align-badge-diff';
            const badgeText = matched ? 'ALIGNED' : 'DIFF';
            const textBold = matched ? 'bold' : '';

            return `
                <div class="q-card ${cardClass}">
                    <div class="q-card-header">
                        <div class="q-num ${numClass}">${i + 1}</div>
                        <div class="q-card-text">${q.text}</div>
                        <div class="align-badge ${badgeClass}">${badgeText}</div>
                    </div>
                    <div class="q-card-answers">
                        <div class="answer-row">
                            <div class="answer-name">JOAKIM</div>
                            <div class="answer-text ${textBold}">${p1Opt}</div>
                        </div>
                        <div class="answer-row">
                            <div class="answer-name">TAIJA</div>
                            <div class="answer-text ${textBold}">${p2Opt}</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Initialize
    renderP1();
    renderP2();
</script>

</body>
</html>
